<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Initialize Plan Templates</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        h1 {
            color: #1a202c;
            margin-bottom: 10px;
            text-align: center;
        }
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
        }
        .info-box {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .info-box h3 {
            margin-top: 0;
            color: #2d3748;
        }
        .plan-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .plan-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }
        .plan-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 8px;
        }
        .plan-detail {
            font-size: 13px;
            color: #4a5568;
            margin: 4px 0;
        }
        .button-container {
            text-align: center;
            margin-top: 30px;
        }
        button {
            padding: 15px 40px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        button:hover:not(:disabled) {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .log {
            background: #1a202c;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            display: none;
        }
        .log.show {
            display: block;
        }
        .log-line {
            margin-bottom: 5px;
        }
        .success {
            color: #10b981;
        }
        .error {
            color: #ef4444;
        }
        .warning {
            color: #f59e0b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Initialize Plan Templates</h1>
        <p class="subtitle">‡∏™‡∏£‡πâ‡∏≤‡∏á Template ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö Dynamic</p>
        
        <div class="info-box">
            <h3>üìã Plan Templates ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á</h3>
            <div class="plan-grid">
                <div class="plan-card">
                    <div class="plan-name">üÜì Free</div>
                    <div class="plan-detail">üë• 3 Users</div>
                    <div class="plan-detail">üìÑ 50 Docs/month</div>
                    <div class="plan-detail">üé® 1 Logo</div>
                    <div class="plan-detail">üíæ 100 MB</div>
                    <div class="plan-detail">üí∞ ‡∏ü‡∏£‡∏µ</div>
                </div>
                
                <div class="plan-card">
                    <div class="plan-name">üíº Basic</div>
                    <div class="plan-detail">üë• 10 Users</div>
                    <div class="plan-detail">üìÑ 200 Docs/month</div>
                    <div class="plan-detail">üé® 5 Logos</div>
                    <div class="plan-detail">üíæ 500 MB</div>
                    <div class="plan-detail">üí∞ 299‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                </div>
                
                <div class="plan-card">
                    <div class="plan-name">üíé Premium</div>
                    <div class="plan-detail">üë• 50 Users</div>
                    <div class="plan-detail">üìÑ 1,000 Docs/month</div>
                    <div class="plan-detail">üé® 20 Logos</div>
                    <div class="plan-detail">üíæ 2 GB</div>
                    <div class="plan-detail">üí∞ 999‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                </div>
                
                <div class="plan-card">
                    <div class="plan-name">üè¢ Enterprise</div>
                    <div class="plan-detail">üë• ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î</div>
                    <div class="plan-detail">üìÑ ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î</div>
                    <div class="plan-detail">üé® ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î</div>
                    <div class="plan-detail">üíæ ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î</div>
                    <div class="plan-detail">üí∞ 2,999‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                </div>
            </div>
        </div>

        <div class="button-container">
            <button id="initBtn" onclick="initializeTemplates()">‚ú® ‡∏™‡∏£‡πâ‡∏≤‡∏á Plan Templates</button>
        </div>

        <div id="log" class="log"></div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, Timestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBy4f-C66l03f4-ODOO_aGyseaIDmDb7tk",
            authDomain: "ecertonline-29a67.firebaseapp.com",
            projectId: "ecertonline-29a67",
            storageBucket: "ecertonline-29a67.firebasestorage.app",
            messagingSenderId: "457246107908",
            appId: "1:457246107908:web:1008539ce20637935c8851"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ‡∏£‡∏≠‡πÉ‡∏´‡πâ Firestore ‡∏û‡∏£‡πâ‡∏≠‡∏°
        let isFirestoreReady = false;
        let isAuthenticated = false;
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Authentication
        auth.onAuthStateChanged((user) => {
            if (user) {
                isAuthenticated = true;
                addLog(`‚úÖ Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${user.email}`, 'success');
                addLog('üîó ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                isFirestoreReady = true;
            } else {
                addLog('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', 'warning');
                // Auto-login with Super Admin (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                tryAutoLogin();
            }
        });
        
        async function tryAutoLogin() {
            // ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏≠‡∏Å email/password
            const email = prompt('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Email ‡∏Ç‡∏≠‡∏á Super Admin:');
            if (!email) {
                addLog('‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£ Login', 'error');
                return;
            }
            const password = prompt('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Password:');
            if (!password) {
                addLog('‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£ Login', 'error');
                return;
            }
            
            try {
                addLog('‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á Login...', 'info');
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                addLog(`‚ùå Login ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
            }
        }

        window.db = db;
        window.doc = doc;
        window.setDoc = setDoc;
        window.getDoc = getDoc;
        window.Timestamp = Timestamp;

        function addLog(message, type = 'info') {
            const logDiv = document.getElementById('log');
            logDiv.classList.add('show');
            const logLine = document.createElement('div');
            logLine.className = `log-line ${type}`;
            logLine.textContent = `[${new Date().toLocaleTimeString('th-TH')}] ${message}`;
            logDiv.appendChild(logLine);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        window.addLog = addLog;

        const DEFAULT_PLAN_TEMPLATES = {
            free: {
                id: 'free',
                name: 'üÜì Free',
                description: '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô',
                maxUsers: 3,
                maxDocuments: 50,
                maxLogos: 1,
                maxStorageMB: 100,
                allowCustomLogo: false,
                features: {
                    multipleProfiles: false,
                    apiAccess: false,
                    customDomain: false,
                    prioritySupport: false,
                    exportPDF: true,
                    exportExcel: false,
                    advancedReports: false,
                    customTemplates: false,
                },
                price: 0,
                currency: 'THB',
                displayOrder: 1,
                isActive: true,
                isPopular: false,
                color: '#9CA3AF',
            },
            basic: {
                id: 'basic',
                name: 'üíº Basic',
                description: '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å',
                maxUsers: 10,
                maxDocuments: 200,
                maxLogos: 5,
                maxStorageMB: 500,
                allowCustomLogo: true,
                features: {
                    multipleProfiles: true,
                    apiAccess: false,
                    customDomain: false,
                    prioritySupport: false,
                    exportPDF: true,
                    exportExcel: true,
                    advancedReports: false,
                    customTemplates: true,
                },
                price: 299,
                currency: 'THB',
                displayOrder: 2,
                isActive: true,
                isPopular: false,
                color: '#3B82F6',
            },
            premium: {
                id: 'premium',
                name: 'üíé Premium',
                description: '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡∏≤‡∏á',
                maxUsers: 50,
                maxDocuments: 1000,
                maxLogos: 20,
                maxStorageMB: 2000,
                allowCustomLogo: true,
                features: {
                    multipleProfiles: true,
                    apiAccess: true,
                    customDomain: false,
                    prioritySupport: true,
                    exportPDF: true,
                    exportExcel: true,
                    advancedReports: true,
                    customTemplates: true,
                },
                price: 999,
                currency: 'THB',
                displayOrder: 3,
                isActive: true,
                isPopular: true,
                color: '#F59E0B',
            },
            enterprise: {
                id: 'enterprise',
                name: 'üè¢ Enterprise',
                description: '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà',
                maxUsers: -1,
                maxDocuments: -1,
                maxLogos: -1,
                maxStorageMB: -1,
                allowCustomLogo: true,
                features: {
                    multipleProfiles: true,
                    apiAccess: true,
                    customDomain: true,
                    prioritySupport: true,
                    exportPDF: true,
                    exportExcel: true,
                    advancedReports: true,
                    customTemplates: true,
                },
                price: 2999,
                currency: 'THB',
                displayOrder: 4,
                isActive: true,
                isPopular: false,
                color: '#8B5CF6',
            },
        };

        window.initializeTemplates = async function() {
            const btn = document.getElementById('initBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...';

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Login ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
            if (!isAuthenticated) {
                addLog('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', 'error');
                btn.disabled = false;
                btn.textContent = '‚ú® ‡∏™‡∏£‡πâ‡∏≤‡∏á Plan Templates';
                return;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Firestore ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
            if (!isFirestoreReady) {
                addLog('‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà', 'warning');
                await new Promise(resolve => setTimeout(resolve, 3000));
            }

            try {
                addLog('üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏° Initialize Plan Templates...', 'info');
                
                let created = 0;
                let skipped = 0;

                for (const [planId, template] of Object.entries(DEFAULT_PLAN_TEMPLATES)) {
                    const templateRef = doc(db, 'planTemplates', planId);
                    
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                    const templateSnap = await getDoc(templateRef);
                    
                    if (!templateSnap.exists()) {
                        await setDoc(templateRef, {
                            ...template,
                            createdAt: Timestamp.now(),
                            updatedAt: Timestamp.now(),
                        });
                        addLog(`‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á template: ${template.name}`, 'success');
                        created++;
                    } else {
                        addLog(`‚è≠Ô∏è  ‡∏Ç‡πâ‡∏≤‡∏°: ${template.name} (‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß)`, 'warning');
                        skipped++;
                    }
                }

                addLog('', 'info');
                addLog(`üìä ‡∏™‡∏£‡∏∏‡∏õ: ‡∏™‡∏£‡πâ‡∏≤‡∏á ${created} templates, ‡∏Ç‡πâ‡∏≤‡∏° ${skipped} templates`, 'info');
                addLog('‚úÖ Initialize Plan Templates ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!', 'success');
                addLog('', 'info');
                addLog('üéâ ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Plan Templates ‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß!', 'success');
                addLog('üìù ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Firebase Console ‚Üí Firestore ‚Üí planTemplates', 'info');

                btn.textContent = '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!';
                btn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';

            } catch (error) {
                console.error('‚ùå Error:', error);
                addLog('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
                btn.disabled = false;
                btn.textContent = 'üîÑ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
            }
        };

        addLog('‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase...', 'info');
    </script>
</body>
</html>

