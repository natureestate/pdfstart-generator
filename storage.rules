rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // ฟังก์ชันตรวจสอบว่าผู้ใช้ Login แล้วหรือยัง
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // ฟังก์ชันตรวจสอบว่าไฟล์เป็นรูปภาพหรือไม่
    function isImage() {
      return request.resource.contentType.matches('image/.*');
    }
    
    // ฟังก์ชันตรวจสอบขนาดไฟล์ (ไม่เกิน 2MB)
    function isValidSize() {
      return request.resource.size < 2 * 1024 * 1024; // 2MB
    }
    
    // โลโก้ทั้งหมด (path: logos/{fileName})
    match /logos/{fileName} {
      // อนุญาตให้อ่านได้ทุกคน (สำหรับแสดงโลโก้ใน PDF และ Gallery)
      allow read: if true;
      
      // อนุญาตให้อัปโหลดได้เฉพาะผู้ใช้ที่ Login แล้ว และต้องเป็นรูปภาพ ขนาดไม่เกิน 2MB
      allow create: if isAuthenticated() 
                    && isImage() 
                    && isValidSize();
      
      // อนุญาตให้ลบได้เฉพาะผู้ใช้ที่ Login แล้ว
      allow delete: if isAuthenticated();
      
      // อนุญาตให้แก้ไข/เขียนทับได้เฉพาะผู้ใช้ที่ Login แล้ว และต้องเป็นรูปภาพ ขนาดไม่เกิน 2MB
      allow update: if isAuthenticated() 
                    && isImage() 
                    && isValidSize();
    }
    
    // Default: ปฏิเสธทุกอย่างอื่น
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
