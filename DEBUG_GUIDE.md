# р╕Др╕╣р╣Ир╕бр╕╖р╕н Debug Multi-User System

## р╕зр╕┤р╕Шр╕╡р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕гр╕░р╕Ър╕Ър╕Чр╕│р╕Зр╕▓р╕Щр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З

### 1. р╣Ар╕Ыр╕┤р╕Ф Browser Console (F12)

р╣Ар╕бр╕╖р╣Ир╕н Login р╣Ар╕Вр╣Йр╕▓р╕гр╕░р╕Ър╕Ъ р╕Др╕╕р╕Ур╕Ир╕░р╣Ар╕лр╣Зр╕Щ logs р╕Фр╕▒р╕Зр╕Щр╕╡р╣Й:

```
ЁЯФД [CompanyContext] р╣Ар╕гр╕┤р╣Ир╕бр╣Вр╕лр╕ер╕Фр╕Ър╕гр╕┤р╕йр╕▒р╕Ч, User: your-email@example.com
тП│ [CompanyContext] р╕Бр╕│р╕ер╕▒р╕Зр╣Вр╕лр╕ер╕Ф...
ЁЯУЛ р╕Фр╕╢р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Чр╕Ир╕▓р╕Б memberships: X р╕нр╕Зр╕Др╣Мр╕Бр╕г
ЁЯУЛ р╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф: X р╕Ър╕гр╕┤р╕йр╕▒р╕Ч
ЁЯУЛ [CompanyContext] р╕Фр╕╢р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Чр╣Др╕Фр╣Й: X р╕нр╕Зр╕Др╣Мр╕Бр╕г [Array]
тЬЕ [CompanyContext] р╣Ар╕ер╕╖р╕нр╕Бр╕Ър╕гр╕┤р╕йр╕▒р╕Чр╣Бр╕гр╕Б: р╕Кр╕╖р╣Ир╕нр╕Ър╕гр╕┤р╕йр╕▒р╕Ч
тЬЕ [CompanyContext] р╣Вр╕лр╕ер╕Фр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ
```

### 2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ CompanySelector

```
ЁЯПв [CompanySelector] Rendered
ЁЯПв [CompanySelector] Current Company: {id: "...", name: "..."}
ЁЯПв [CompanySelector] All Companies: [{...}, {...}]
ЁЯПв [CompanySelector] Loading: false
ЁЯПв [CompanySelector] Show Dropdown: false
```

### 3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Admin Status

```
ЁЯСС [Header] р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕┤р╕Чр╕Шр╕┤р╣М Admin
ЁЯСС [Header] User: your-email@example.com
ЁЯСС [Header] Current Company: р╕Кр╕╖р╣Ир╕нр╕Ър╕гр╕┤р╕йр╕▒р╕Ч company-id
ЁЯСС [Header] Admin Status: true/false
```

## р╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╕нр╕▓р╕Ир╕Юр╕Ър╣Бр╕ер╕░р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й

### р╕Ыр╕▒р╕Нр╕лр╕▓ 1: р╣Др╕бр╣Ир╕бр╕╡р╕Ър╕гр╕┤р╕йр╕▒р╕Чр╣Ар╕ер╕в (companies.length = 0)

**р╕кр╕▓р╣Ар╕лр╕Хр╕╕:**
- р╕вр╕▒р╕Зр╣Др╕бр╣Ир╣Ар╕Др╕вр╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Ч
- Firestore Rules р╕Ър╕ер╣Зр╕нр╕Бр╕Бр╕▓р╕гр╕нр╣Ир╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е
- User р╣Др╕бр╣Ир╕бр╕╡р╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╣Ар╕Вр╣Йр╕▓р╕Цр╕╢р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Ч

**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й:**
1. р╕Др╕ер╕┤р╕Бр╕Ыр╕╕р╣Ир╕б Company Selector тЖТ р╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Чр╣Гр╕лр╕бр╣И
2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Firestore Rules
3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡ document р╣Гр╕Щ collection `companyMembers` р╕лр╕гр╕╖р╕нр╣Др╕бр╣И

### р╕Ыр╕▒р╕Нр╕лр╕▓ 2: Dropdown р╣Др╕бр╣Ир╣Бр╕кр╕Фр╕З

**р╕кр╕▓р╣Ар╕лр╕Хр╕╕:**
- `companies.length === 0` тЖТ р╕Ир╕░р╣Бр╕кр╕Фр╕Зр╕Ыр╕╕р╣Ир╕бр╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Чр╣Бр╕Чр╕Щ
- `currentCompany === null` тЖТ р╕Ир╕░р╣Бр╕кр╕Фр╕Зр╕Ыр╕╕р╣Ир╕бр╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Чр╣Бр╕Чр╕Щ

**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й:**
1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Console р╕зр╣Ир╕▓ `companies` р╕бр╕╡р╕Др╣Ир╕▓р╕лр╕гр╕╖р╕нр╣Др╕бр╣И
2. р╕Цр╣Йр╕▓р╕бр╕╡р╕Ър╕гр╕┤р╕йр╕▒р╕Чр╣Бр╕ер╣Йр╕з р╣Бр╕Хр╣И dropdown р╣Др╕бр╣Ир╣Бр╕кр╕Фр╕З тЖТ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ `showDropdown` state

### р╕Ыр╕▒р╕Нр╕лр╕▓ 3: Role Badge р╣Др╕бр╣Ир╣Бр╕кр╕Фр╕З

**р╕кр╕▓р╣Ар╕лр╕Хр╕╕:**
- `currentCompany === null` тЖТ Badge р╕Ир╕░р╣Др╕бр╣Ир╣Бр╕кр╕Фр╕З (р╕Хр╕▓р╕б code р╕Чр╕╡р╣И line 69 р╣Гр╕Щ Header.tsx)
- `isAdmin` р╕вр╕▒р╕Зр╣Др╕бр╣Ир╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Др╣Ир╕▓р╕Ир╕▓р╕Б `checkIsAdmin()`

**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й:**
1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ `currentCompany` р╕бр╕╡р╕Др╣Ир╕▓р╕лр╕гр╕╖р╕нр╣Др╕бр╣И
2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Console р╕зр╣Ир╕▓ `checkIsAdmin()` р╕Чр╕│р╕Зр╕▓р╕Щр╕лр╕гр╕╖р╕нр╣Др╕бр╣И
3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡ document р╣Гр╕Щ `companyMembers` collection р╕лр╕гр╕╖р╕нр╣Др╕бр╣И

### р╕Ыр╕▒р╕Нр╕лр╕▓ 4: р╕Ыр╕╕р╣Ир╕б "р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б" р╣Др╕бр╣Ир╣Бр╕кр╕Фр╕З

**р╕кр╕▓р╣Ар╕лр╕Хр╕╕:**
- `isAdmin === false` тЖТ р╕Ыр╕╕р╣Ир╕бр╕Ир╕░р╣Др╕бр╣Ир╣Бр╕кр╕Фр╕З (р╣Ар╕Йр╕Юр╕▓р╕░ Admin р╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щ)
- `currentCompany === null` тЖТ р╕Ыр╕╕р╣Ир╕бр╕Ир╕░р╣Др╕бр╣Ир╣Бр╕кр╕Фр╕З

**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й:**
1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Др╕╕р╕Ур╣Ар╕Ыр╣Зр╕Щ Admin р╕лр╕гр╕╖р╕нр╣Др╕бр╣И (р╕Фр╕╣р╕Чр╕╡р╣И Console)
2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Firestore collection `companyMembers` р╕зр╣Ир╕▓р╕бр╕╡ document р╕Чр╕╡р╣И:
   - `userId` = User ID р╕Вр╕нр╕Зр╕Др╕╕р╕У
   - `companyId` = Company ID р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ
   - `role` = "admin"
   - `status` = "active"

## р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щ Firestore

### Collection: `companies`

```
{
  id: "auto-generated-id",
  name: "р╕Кр╕╖р╣Ир╕нр╕Ър╕гр╕┤р╕йр╕▒р╕Ч",
  address: "р╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣И",
  userId: "user-id-р╕Вр╕нр╕З-admin-р╕Др╕Щр╣Бр╕гр╕Б",
  memberCount: 1,
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

### Collection: `companyMembers`

```
{
  id: "auto-generated-id",
  companyId: "company-id",
  userId: "user-id",
  email: "email@example.com",
  role: "admin" | "member",
  status: "active" | "pending" | "inactive",
  joinedAt: Timestamp,
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

## Firestore Indexes р╕Чр╕╡р╣Ир╕Ир╕│р╣Ар╕Ыр╣Зр╕Щ

р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡ indexes р╕Фр╕▒р╕Зр╕Щр╕╡р╣Й:

1. **companyMembers**: `companyId` (Ascending) + `createdAt` (Descending)
2. **companyMembers**: `userId` (Ascending) + `status` (Ascending) + `createdAt` (Descending)
3. **companyMembers**: `companyId` (Ascending) + `userId` (Ascending) + `role` (Ascending) + `status` (Ascending)

## р╕Др╕│р╕кр╕▒р╣Ир╕З Debug р╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б

### р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ User р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ

р╣Ар╕Ыр╕┤р╕Ф Console р╣Бр╕ер╣Йр╕зр╕Юр╕┤р╕бр╕Юр╣М:

```javascript
firebase.auth().currentUser
```

### р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Companies

```javascript
// р╣Гр╕Щ Console
const { companies, currentCompany } = useCompany()
console.log('Companies:', companies)
console.log('Current:', currentCompany)
```

### Force Refresh Companies

```javascript
// р╣Гр╕Щ Console (р╕Цр╣Йр╕▓р╣Гр╕Кр╣Йр╣Др╕Фр╣Й)
refreshCompanies()
```

## р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ Multi-User System

### р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 1: р╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Ч

1. Login р╕Фр╣Йр╕зр╕в User A
2. р╕Др╕ер╕┤р╕Б Company Selector тЖТ р╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Чр╣Гр╕лр╕бр╣И
3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╣Ар╕лр╣Зр╕Щ:
   - Company Dropdown р╣Бр╕кр╕Фр╕Зр╕Кр╕╖р╣Ир╕нр╕Ър╕гр╕┤р╕йр╕▒р╕Ч
   - Role Badge р╣Бр╕кр╕Фр╕З "ЁЯСС Admin"
   - р╕Ыр╕╕р╣Ир╕б "р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б" р╣Бр╕кр╕Фр╕З

### р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 2: р╣Ар╕Кр╕┤р╕Нр╕кр╕бр╕▓р╕Кр╕┤р╕Б

1. р╕Др╕ер╕┤р╕Бр╕Ыр╕╕р╣Ир╕б "р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б"
2. р╕Бр╕гр╕нр╕Бр╕нр╕╡р╣Ар╕бр╕ер╕Вр╕нр╕З User B
3. р╣Ар╕ер╕╖р╕нр╕Бр╕Ър╕Чр╕Ър╕▓р╕Ч (Admin р╕лр╕гр╕╖р╕н Member)
4. р╕Др╕ер╕┤р╕Б "р╣Ар╕Кр╕┤р╕Нр╕кр╕бр╕▓р╕Кр╕┤р╕Б"

### р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 3: р╕Чр╕Фр╕кр╕нр╕Ъ User B

1. Logout р╕Ир╕▓р╕Б User A
2. Login р╕Фр╣Йр╕зр╕в User B (р╕нр╕╡р╣Ар╕бр╕ер╕Чр╕╡р╣Ир╕Цр╕╣р╕Бр╣Ар╕Кр╕┤р╕Н)
3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╣Ар╕лр╣Зр╕Щр╕Ър╕гр╕┤р╕йр╕▒р╕Чр╣Гр╕Щ Company Dropdown
4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Role Badge (Admin р╕лр╕гр╕╖р╕н Member)
5. р╕Цр╣Йр╕▓р╣Ар╕Ыр╣Зр╕Щ Member р╕Ир╕░р╣Др╕бр╣Ир╣Ар╕лр╣Зр╕Щр╕Ыр╕╕р╣Ир╕б "р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б"

## р╕Хр╕┤р╕Фр╕Хр╣Ир╕н Support

р╕лр╕▓р╕Бр╕вр╕▒р╕Зр╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓ р╕Бр╕гр╕╕р╕Ур╕▓р╕кр╣Ир╕З:
1. Screenshot р╕Вр╕нр╕З Browser Console
2. Screenshot р╕Вр╕нр╕З Firestore Data
3. р╕нр╕Шр╕┤р╕Ър╕▓р╕вр╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣Ир╕Чр╕│р╕Бр╣Ир╕нр╕Щр╣Ар╕Бр╕┤р╕Фр╕Ыр╕▒р╕Нр╕лр╕▓

