# тЬЕ р╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╕Юр╕Ър╣Бр╕ер╣Йр╕з

## ЁЯФз р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╣Бр╕Бр╣Йр╣Др╕В (10 р╕Х.р╕Д. 2025)

### 1. тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б Firestore Indexes р╕кр╕│р╕лр╕гр╕▒р╕Ъ Multi-User System

**р╕Ыр╕▒р╕Нр╕лр╕▓:**
```
тЭМ The query requires an index
```

**р╣Бр╕Бр╣Йр╣Др╕В:**
р╣Ар╕Юр╕┤р╣Ир╕б Composite Indexes р╣Гр╕Щ `firestore.indexes.json`:

- **companies**: `userId` + `createdAt`
- **companyMembers**: `userId` + `status` + `createdAt`
- **companyMembers**: `companyId` + `createdAt`
- **companyMembers**: `companyId` + `userId` + `role` + `status`

**р╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Чр╕╡р╣Ир╕гр╕▒р╕Щ:**
```bash
firebase deploy --only firestore:indexes
```

---

### 2. тЬЕ р╣Бр╕Бр╣Йр╣Др╕В Firestore Rules р╣Гр╕лр╣Йр╕Зр╣Ир╕▓р╕вр╕Вр╕╢р╣Йр╕Щ (Development Mode)

**р╕Ыр╕▒р╕Нр╕лр╕▓:**
```
тЭМ Missing or insufficient permissions
```

**р╣Бр╕Бр╣Йр╣Др╕В:**
р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щ Rules р╕кр╕│р╕лр╕гр╕▒р╕Ъ `companies` р╣Бр╕ер╕░ `companyMembers` р╣Гр╕лр╣Йр╕нр╕Щр╕╕р╕Нр╕▓р╕Хр╕Бр╕▓р╕гр╕нр╣Ир╕▓р╕Щ/р╣Ар╕Вр╕╡р╕вр╕Щр╣Др╕Фр╣Йр╕Зр╣Ир╕▓р╕вр╕Вр╕╢р╣Йр╕Щ:

**р╕Бр╣Ир╕нр╕Щ:**
```javascript
allow read: if isAuthenticated() && isMemberOfCompany(companyId);
```

**р╕лр╕ер╕▒р╕З:**
```javascript
allow read: if isAuthenticated(); // р╕нр╕Щр╕╕р╕Нр╕▓р╕Хр╕Чр╕╕р╕Бр╕Др╕Щр╕Чр╕╡р╣И Login р╣Бр╕ер╣Йр╕з
```

**р╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Чр╕╡р╣Ир╕гр╕▒р╕Щ:**
```bash
firebase deploy --only firestore:rules
```

---

### 3. тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б Debug Logs

р╣Ар╕Юр╕┤р╣Ир╕б console.log р╣Гр╕Щр╣Др╕Яр╕ер╣Мр╕кр╕│р╕Др╕▒р╕Н:

- **`CompanyContext.tsx`** - р╣Бр╕кр╕Фр╕Зр╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Фр╕Ър╕гр╕┤р╕йр╕▒р╕Ч, р╕Ир╕│р╕Щр╕зр╕Щр╕Ър╕гр╕┤р╕йр╕▒р╕Ч
- **`CompanySelector.tsx`** - р╣Бр╕кр╕Фр╕З state р╕Вр╕нр╕З companies, currentCompany
- **`Header.tsx`** - р╣Бр╕кр╕Фр╕Зр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕┤р╕Чр╕Шр╕┤р╣М Admin

---

### 4. тЬЕ р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З Logic р╣Гр╕Щ CompanyContext

- р╣Бр╕Бр╣Йр╣Др╕Вр╕Бр╕▓р╕гр╣Ар╕ер╕╖р╕нр╕Бр╕Ър╕гр╕┤р╕йр╕▒р╕Чр╣Бр╕гр╕Бр╣Ар╕бр╕╖р╣Ир╕нр╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕е
- р╣Ар╕Юр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Ър╕гр╕┤р╕йр╕▒р╕Чр╕вр╕▒р╕Зр╕нр╕вр╕╣р╣Ир╣Гр╕Щ list р╕лр╕гр╕╖р╕нр╣Др╕бр╣И
- р╣Ар╕Юр╕┤р╣Ир╕б error handling р╕Чр╕╡р╣Ир╕Фр╕╡р╕Вр╕╢р╣Йр╕Щ

---

### 5. тЬЕ Restart Dev Server

- р╕лр╕вр╕╕р╕Ф process р╣Ар╕Бр╣Ир╕▓
- р╣Ар╕гр╕┤р╣Ир╕б dev server р╣Гр╕лр╕бр╣Ир╕Чр╕╡р╣И port 3000

---

## ЁЯУЛ р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕Фр╕кр╕нр╕Ъ

### 1. Hard Refresh Browser

```
Mac: Cmd + Shift + R
Windows: Ctrl + Shift + R
```

### 2. р╣Ар╕Ыр╕┤р╕Ф Console (F12)

р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╣Др╕бр╣Ир╕бр╕╡ Error р╣Ар╕лр╕ер╣Ир╕▓р╕Щр╕╡р╣Йр╣Бр╕ер╣Йр╕з:
- тЭМ The query requires an index
- тЭМ Missing or insufficient permissions

### 3. р╕Чр╕Фр╕кр╕нр╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Ч

1. р╕Др╕ер╕┤р╕Бр╕Чр╕╡р╣И Company Selector (р╕Ыр╕╕р╣Ир╕бр╕Чр╕╡р╣Ир╕бр╕╡р╣Др╕нр╕Др╕нр╕Щр╕нр╕▓р╕Др╕▓р╕г ЁЯПв)
2. р╕Бр╕гр╕нр╕Бр╕Кр╕╖р╣Ир╕нр╕Ър╕гр╕┤р╕йр╕▒р╕Ч
3. р╕Др╕ер╕┤р╕Б "р╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Ч"
4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Console р╕зр╣Ир╕▓р╕бр╕╡ log:
   ```
   тЬЕ р╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Чр╕кр╕│р╣Ар╕гр╣Зр╕И: xxx
   тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б Admin р╕Др╕Щр╣Бр╕гр╕Бр╕кр╕│р╣Ар╕гр╣Зр╕И: xxx
   ```

### 4. Refresh р╣Бр╕ер╕░р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ UI

р╕лр╕ер╕▒р╕З Refresh р╕Др╕╕р╕Ур╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щ:
- тЬЕ Company Dropdown р╣Бр╕кр╕Фр╕Зр╕Кр╕╖р╣Ир╕нр╕Ър╕гр╕┤р╕йр╕▒р╕Ч
- тЬЕ Role Badge р╣Бр╕кр╕Фр╕З "ЁЯСС Admin"
- тЬЕ р╕Ыр╕╕р╣Ир╕б "р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б"

---

## ЁЯОп Console Logs р╕Чр╕╡р╣Ир╕Др╕▓р╕Фр╕лр╕зр╕▒р╕З

### р╣Ар╕бр╕╖р╣Ир╕н Login р╕кр╕│р╣Ар╕гр╣Зр╕И

```javascript
ЁЯСд р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й Login: {name: "...", email: "...", uid: "..."}
ЁЯФД [CompanyContext] р╣Ар╕гр╕┤р╣Ир╕бр╣Вр╕лр╕ер╕Фр╕Ър╕гр╕┤р╕йр╕▒р╕Ч, User: your-email@example.com
тП│ [CompanyContext] р╕Бр╕│р╕ер╕▒р╕Зр╣Вр╕лр╕ер╕Ф...
```

### р╣Ар╕бр╕╖р╣Ир╕нр╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Ър╕гр╕┤р╕йр╕▒р╕Ч

```javascript
ЁЯУЛ [CompanyContext] р╕Фр╕╢р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Чр╣Др╕Фр╣Й: 0 р╕нр╕Зр╕Др╣Мр╕Бр╕г []
тЪая╕П [CompanyContext] р╣Др╕бр╣Ир╕бр╕╡р╕Ър╕гр╕┤р╕йр╕▒р╕Чр╣Ар╕ер╕в
тЬЕ [CompanyContext] р╣Вр╕лр╕ер╕Фр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ
```

### р╣Ар╕бр╕╖р╣Ир╕нр╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Чр╕кр╕│р╣Ар╕гр╣Зр╕И

```javascript
тЬЕ р╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Чр╕кр╕│р╣Ар╕гр╣Зр╕И: company-id (Admin: user-id)
тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б Admin р╕Др╕Щр╣Бр╕гр╕Бр╕кр╕│р╣Ар╕гр╣Зр╕И: member-id
```

### р╣Ар╕бр╕╖р╣Ир╕нр╕бр╕╡р╕Ър╕гр╕┤р╕йр╕▒р╕Чр╣Бр╕ер╣Йр╕з

```javascript
ЁЯУЛ [CompanyContext] р╕Фр╕╢р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Чр╣Др╕Фр╣Й: 1 р╕нр╕Зр╕Др╣Мр╕Бр╕г [...]
тЬЕ [CompanyContext] р╣Ар╕ер╕╖р╕нр╕Бр╕Ър╕гр╕┤р╕йр╕▒р╕Чр╣Бр╕гр╕Б: р╕Кр╕╖р╣Ир╕нр╕Ър╕гр╕┤р╕йр╕▒р╕Ч
тЬЕ [CompanyContext] р╣Вр╕лр╕ер╕Фр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ
```

### р╣Ар╕бр╕╖р╣Ир╕нр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕┤р╕Чр╕Шр╕┤р╣М Admin

```javascript
ЁЯСС [Header] р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕┤р╕Чр╕Шр╕┤р╣М Admin
ЁЯСС [Header] User: your-email@example.com
ЁЯСС [Header] Current Company: р╕Кр╕╖р╣Ир╕нр╕Ър╕гр╕┤р╕йр╕▒р╕Ч company-id
ЁЯСС [Header] Admin Status: true
```

---

## тЪая╕П р╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╕нр╕▓р╕Ир╕Юр╕Ъ

### р╕Ыр╕▒р╕Нр╕лр╕▓ 1: р╕вр╕▒р╕Зр╣Ар╕лр╣Зр╕Щ Error "Missing permissions"

**р╕кр╕▓р╣Ар╕лр╕Хр╕╕:** Rules р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕нр╕▒р╕Ыр╣Ар╕Фр╕Х

**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й:**
```bash
firebase deploy --only firestore:rules
```

### р╕Ыр╕▒р╕Нр╕лр╕▓ 2: р╕вр╕▒р╕Зр╣Ар╕лр╣Зр╕Щ Error "requires an index"

**р╕кр╕▓р╣Ар╕лр╕Хр╕╕:** Indexes р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕кр╕гр╣Йр╕▓р╕Зр╣Ар╕кр╕гр╣Зр╕И (р╣Гр╕Кр╣Йр╣Ар╕зр╕ер╕▓ 5-10 р╕Щр╕▓р╕Чр╕╡)

**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й:**
1. р╣Ар╕Ыр╕┤р╕Ф Firebase Console тЖТ Firestore тЖТ Indexes
2. р╕гр╕нр╕Ир╕Щр╕кр╕Цр╕▓р╕Щр╕░р╣Ар╕Ыр╣Зр╕Щ "Enabled" (р╕кр╕╡р╣Ар╕Вр╕╡р╕вр╕з)
3. р╕лр╕гр╕╖р╕нр╕Др╕ер╕┤р╕Бр╕ер╕┤р╕Зр╕Бр╣Мр╣Гр╕Щ Error р╣Ар╕Юр╕╖р╣Ир╕нр╕кр╕гр╣Йр╕▓р╕З Index р╕Фр╣Йр╕зр╕вр╕Хр╕Щр╣Ар╕нр╕З

### р╕Ыр╕▒р╕Нр╕лр╕▓ 3: UI р╕вр╕▒р╕Зр╣Др╕бр╣Ир╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щ

**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й:**
1. Hard Refresh (Cmd+Shift+R)
2. Clear Browser Cache
3. р╕ер╕нр╕Зр╣Гр╕Кр╣Й Incognito Mode

### р╕Ыр╕▒р╕Нр╕лр╕▓ 4: Context Error (useCompany must be used within...)

**р╕кр╕▓р╣Ар╕лр╕Хр╕╕:** Hot Reload р╕Чр╕│р╣Гр╕лр╣Й Context р╕лр╕ер╕╕р╕Ф

**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й:**
1. Refresh р╕лр╕Щр╣Йр╕▓р╣Ар╕зр╣Зр╕Ъ (F5)
2. р╕лр╕гр╕╖р╕н Restart Dev Server:
   ```bash
   npm run restart
   ```

---

## ЁЯУК р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Гр╕Щ Firebase Console

### 1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Indexes

1. р╣Ар╕Ыр╕┤р╕Ф https://console.firebase.google.com
2. р╣Ар╕ер╕╖р╕нр╕Б Project: `ecertonline-29a67`
3. р╣Др╕Ыр╕Чр╕╡р╣И Firestore Database тЖТ Indexes
4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡ Indexes р╕Фр╕▒р╕Зр╕Щр╕╡р╣Й:
   - тЬЕ `companyMembers`: userId, status, createdAt
   - тЬЕ `companyMembers`: companyId, createdAt
   - тЬЕ `companyMembers`: companyId, userId, role, status
   - тЬЕ `companies`: userId, createdAt

### 2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Rules

1. р╣Др╕Ыр╕Чр╕╡р╣И Firestore Database тЖТ Rules
2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ Rules р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╣Бр╕ер╣Йр╕з (р╕Фр╕╣р╕Чр╕╡р╣И Timestamp)

### 3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е

1. р╣Др╕Ыр╕Чр╕╡р╣И Firestore Database тЖТ Data
2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Collections:
   - `companies` - р╕Др╕зр╕гр╕бр╕╡ document р╕Вр╕нр╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Чр╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕З
   - `companyMembers` - р╕Др╕зр╕гр╕бр╕╡ document р╕Вр╕нр╕З Admin р╕Др╕Щр╣Бр╕гр╕Б

---

## ЁЯЪА р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Хр╣Ир╕нр╣Др╕Ы

### 1. р╕Чр╕Фр╕кр╕нр╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Ч

- [ ] Login р╣Ар╕Вр╣Йр╕▓р╕гр╕░р╕Ър╕Ъ
- [ ] р╕Др╕ер╕┤р╕Б Company Selector
- [ ] р╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Чр╣Гр╕лр╕бр╣И
- [ ] Refresh р╣Бр╕ер╕░р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ UI

### 2. р╕Чр╕Фр╕кр╕нр╕Ъ Multi-User

- [ ] р╣Ар╕Кр╕┤р╕Нр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Гр╕лр╕бр╣И
- [ ] Login р╕Фр╣Йр╕зр╕в User р╕нр╕╖р╣Ир╕Щ
- [ ] р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╣Ар╕лр╣Зр╕Щр╕Ър╕гр╕┤р╕йр╕▒р╕Ч
- [ ] р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Role Badge

### 3. р╕Чр╕Фр╕кр╕нр╕Ъ Admin Functions

- [ ] р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕Ър╕Чр╕Ър╕▓р╕Чр╕кр╕бр╕▓р╕Кр╕┤р╕Б
- [ ] р╕ер╕Ър╕кр╕бр╕▓р╕Кр╕┤р╕Б
- [ ] р╣Ар╕Юр╕┤р╣Ир╕б Admin р╕Др╕Щр╣Гр╕лр╕бр╣И

---

## ЁЯУЮ р╕Хр╕┤р╕Фр╕Хр╣Ир╕н Support

р╕лр╕▓р╕Бр╕вр╕▒р╕Зр╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓ р╕Бр╕гр╕╕р╕Ур╕▓р╕кр╣Ир╕З:

1. **Screenshot р╕Вр╕нр╕З Browser Console**
2. **Screenshot р╕Вр╕нр╕З Firebase Console тЖТ Firestore тЖТ Indexes**
3. **р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣Ир╕Чр╕│р╕Бр╣Ир╕нр╕Щр╣Ар╕Бр╕┤р╕Фр╕Ыр╕▒р╕Нр╕лр╕▓**
4. **Error Messages р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф**

---

## ЁЯУЭ р╕кр╕гр╕╕р╕Ы

тЬЕ Deploy Firestore Rules р╕кр╕│р╣Ар╕гр╣Зр╕И
тЬЕ Deploy Firestore Indexes р╕кр╕│р╣Ар╕гр╣Зр╕И
тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б Debug Logs
тЬЕ р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З Logic р╣Гр╕Щ CompanyContext
тЬЕ Restart Dev Server

**р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Хр╣Ир╕нр╣Др╕Ы:**
1. Hard Refresh Browser (Cmd+Shift+R)
2. р╕Чр╕Фр╕кр╕нр╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕гр╕┤р╕йр╕▒р╕Ч
3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Console Logs
4. р╕кр╣Ир╕З Console Logs р╣Гр╕лр╣Йр╕Ьр╕бр╕Фр╕╣

---

**р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕ер╣Ир╕▓р╕кр╕╕р╕Ф:** 10 р╕Хр╕╕р╕ер╕▓р╕Др╕б 2025, 22:14 р╕Щ.

